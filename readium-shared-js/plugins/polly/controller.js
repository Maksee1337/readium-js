define(['jquery', 'eventEmitter', './content.service', './pollyService', './audio.service'],    function($, EventEmitter, ContentService, PollyService, AudioService) {    return function (polly) {        let self = this;        let _audioService;        let _contentService = new ContentService();        let _pollyService = new PollyService(new AWS.Polly({apiVersion: '2016-06-10'}));        let _currentChapter = '';        let _spansParts;        let _jsonObjects;        this.getTTSForChapter = function () {            if (_currentChapter === _contentService.getCurrentChapterName()) return;            if(_audioService){                _audioService.stopAudio();                delete _audioService;            }            _currentChapter = _contentService.getCurrentChapterName();            _spansParts = _contentService.addSpansToTextParts(_currentChapter);            _pollyService.getJSONObjects(_spansParts).then((data) => {                _jsonObjects = data;                _contentService.addSpansToWords(_jsonObjects, _spansParts);              //  self.initAudio();            });        }        this.initAudio = function () {            _pollyService.getAudioLinks(_spansParts).then((data) => {                _audioService = new AudioService(data, _spansParts, _jsonObjects);                _contentService.addClickHandler(_audioService);            });        }        this.playAudio = function (id = 0) {                _audioService.playAudio(id);        }    };});